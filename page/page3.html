<!-- Meta Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '751344069366440');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=751344069366440&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
<!-- Meta Pixel Code -->
<head>
    <meta name="facebook-domain-verification" content="msckfm61jj25rmbh4gt4vwbvx468xa" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>


<body>
    <h1>Page3</h1>
    <button onclick="cartBtn()">Add to cart</button><br/><br/><br/>
    <button onclick="purchaseBtn()">Purchase</button><br/>

</body>


<script>
    var logTime = Math.floor(Date.now() / 1000);
    let agent = navigator.userAgent;
    let token = "EAAhkCOaZBncIBAFvmBYgLsgWQBr8tbeNpQ6rBi4MmBms7VsArPe4ZAZAWvmZAchsOZBiCJcjYZBr7DDAotuNkFaPZAqZCZBI3F4VD0ZBLPrOM9YHte9ShmwFENeMdR2FxfUezWNlzYIgiOVFiKhofX6YoIELAg4ztvZBG4tuci3iT2yhn3LwsCXCZCWxMWpPZCA3BMiUZD";
    var conversionData = {
        "data": [
            {
                "event_name": "add_to_cart",
                "event_time": logTime,
                "action_source": "email",
                "user_data": {
                    "client_user_agent": agent,
                    "em": [
                        "7b17fb0bd173f625b58636fb796407c22b3d16fc78302d79f0fd30c2fc2fc068"
                    ]
                },
                "custom_data": {
                    "currency": "KWD",
                    "value": "100"
                }
            }
        ]
    };

    function cartBtn() {
        conversionData.data[0].event_name='add_to_cart';
        console.log(conversionData.data[0].event_name);
        sendConversionAPI(conversionData);
    }
    
    function purchaseBtn() {
        conversionData.data[0].event_name='purchase';
        console.log(conversionData.data[0].event_name);
        sendConversionAPI(conversionData);
    }
    
    function sendConversionAPI(jsonData) {
        $.ajax({
            type: "POST",
            url: 'https://graph.facebook.com/v14.0/751344069366440/events?access_token='+token,
            data: conversionData,
            contentType: 'application/json',
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Access-Control-Allow-Origin", "*");
                xhr.setRequestHeader("Access-Control-Allow-Methods", "GET,POST,PUT,DELETE");
                xhr.setRequestHeader("Access-Control-Allow-Headers", "Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With");
            }, success: function(data){
                console.log(data);
                // alert(data);
                //process the JSON data etc
            }
        })
    }
    
    // console.log(conversionData);
    // console.log(conversionData.data[0].event_name)
    

</script>